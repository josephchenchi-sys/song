# 功能規格：使用 Vue.js 重構前端

**功能分支**: `002-refactor-frontend-vue`  
**建立日期**: 2026-01-07  
**狀態**: 草案  
**輸入**: 使用者描述: "使用Vue框架重構前端"

## 澄清事項 (Clarifications)

### 2026-01-07
- Q: 是否繼續使用 Vite 作為構建工具？ → A: 是，繼續使用 Vite
- Q: 使用何種狀態管理方案？ → A: 使用原生的 `reactive` / `ref` (Composition API)
- Q: 如何處理現有的 CSS 樣式？ → A: 引入 Tailwind CSS
- Q: 採用何種遷移策略？ → A: 逐個功能遷移
- Q: 是否遷移至 TypeScript？ → A: 是，遷移至 TypeScript

## 使用者情境與測試 *(必填)*

### 使用者情境 1 - 影片處理流程 (優先級: P1)

作為一名使用者，我想要上傳影片並進行處理以移除人聲，以便獲得伴奏版本。

**為何是此優先級**: 這是應用程式的核心價值主張。

**獨立測試**: 可透過上傳有效的影片檔案並驗證處理階段（提取 -> 分離 -> 合成）是否成功完成來進行測試。

**驗收情境**:

1. **假設** 應用程式已載入，**當** 我選擇一個有效的影片檔案（MP4/WebM/MOV）時，**則** 「開始處理」按鈕變為可用狀態。
2. **假設** 已選擇檔案，**當** 我點擊「開始處理」時，**則** UI 顯示進度條以及每個階段（提取中、分離中、合成中）的狀態更新。
3. **假設** 處理完成，**當** 特定階段結束時，**則** 「下載」按鈕變為可用狀態，且預覽播放器出現。

---

### 使用者情境 2 - 卡拉 OK 預覽播放器 (優先級: P1)

作為一名使用者，我想要預覽結果並使用卡拉 OK 控制項（切換人聲、升降 Key），以便在下載前進行練唱。

**為何是此優先級**: 對使用者體驗至關重要（卡拉 OK 模式）。

**獨立測試**: 處理完影片後，透過與播放器控制項互動進行測試。

**驗收情境**:

1. **假設** 處理完成，**當** 我點擊「播放」時，**則** 影片與音訊同步播放。
2. **假設** 播放器處於活動狀態，**當** 我切換「人聲」勾選框時，**則** 人聲軌道立即被靜音/取消靜音。
3. **假設** 播放器處於活動狀態，**當** 我點擊升降 Key 按鈕時，**則** 音訊音高改變但不改變播放速度，且顯示數值更新（例如：+1, -1）。
4. **假設** 播放器處於活動狀態，**當** 我拖動進度條時，**則** 影片與音訊皆跳轉至正確的時間點。

---

### 使用者情境 3 - 下載伴奏 (優先級: P2)

作為一名使用者，我想要下載最終的伴奏影片，以便保存供日後使用。

**為何是此優先級**: 允許使用者將產出的價值帶走。

**獨立測試**: 點擊下載並驗證檔案是否生成。

**驗收情境**:

1. **假設** 處理完成，**當** 我點擊「下載」時，**則** 瀏覽器提示儲存 `instrumental.mp4` 檔案。
2. **假設** 我已套用升降 Key，**當** 我下載時，**則** 下載的檔案應包含音高調整（依據現有邏輯保留，目前隱含包含音高調整的合成）。

### 邊界情況

- **無效檔案類型**: 如果使用者上傳非影片檔案，顯示警告且不開始處理。
- **行動裝置瀏覽器**: 如果從行動裝置存取，顯示「行動裝置警告」橫幅（效能限制）。
- **處理錯誤**: 如果 `processor.js` 拋出錯誤（例如：記憶體不足 OOM），在狀態區域顯示錯誤訊息並重設狀態以允許重試。
- **瀏覽器相容性**: 如果 `SharedArrayBuffer` 不可用（COOP/COEP 問題），應用程式應優雅地失敗（或顯示特定錯誤）。

## 需求 *(必填)*

### 功能需求

- **FR-001**: 應用程式必須使用 **Vue 3** 框架建構，並繼續使用 **Vite** 作為開發與構建工具。
- **FR-002**: 應用程式必須使用 **Vue 3 Composition API (ref/reactive)** 進行狀態管理，完全取代現有的 `store.js` 事件發送器模式，不需引入 Pinia。
- **FR-003**: 應用程式邏輯必須避免直接操縱 DOM（例如：`document.getElementById`, `querySelector`），改用 Vue 模板綁定和 `ref`。
- **FR-004**: UI 必須重構為模組化的 Vue 組件（例如：`<FileUpload>`, `<ProgressDisplay>`, `<KaraokePlayer>`）。
- **FR-005**: 應用程式必須保留所有現有的 `processor.js` (Demucs/FFmpeg) 和 `audio-player.js` (Web Audio API) 整合，確保它們在 Vue 生命週期（掛載/卸載）內正常運作。
- **FR-006**: 應用程式必須維持現有的響應式設計和「行動裝置警告」邏輯。
- **FR-007**: 樣式處理應遷移至 **Tailwind CSS**，以取代現有的 `style.css`。
- **FR-008**: 專案應遷移至 **TypeScript**，為新的 Vue 組件和狀態管理提供類型定義。

### 關鍵實體 *(包含如果功能涉及資料)*

- **SourceMedia**: 代表上傳的檔案（檔案物件、URL、元數據）。
- **ProcessingState**: 追蹤當前狀態（閒置、載入中、提取中、分離中、合成中、錯誤）與進度百分比。
- **PlaybackState**: 追蹤播放狀態、當前時間、人聲開關以及音高調整值。

## 成功標準 *(必填)*

### 可衡量的成果

- **SC-001**: **零功能退化**: 所有現有的使用者情境（上傳、處理、預覽、下載）皆通過測試，且行為與原生 JS 版本一致。
- **SC-002**: **程式碼品質**: `src/js/app.js` 被 Vue 入口檔案取代，主邏輯中不再殘留任何舊有的 DOM 選擇程式碼。
- **SC-003**: **效能**: 應用程式成功載入並初始化 AI 模型，且不會因組件重新渲染導致記憶體洩漏。
